<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Kim Altintop (kim@monadic.xyz)" />
  <meta name="author" content="The Radicle Team (dev@radicle.xyz)" />
  <title>Radicle Link</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="spec.css" type="text/css" />
</head>
<body>
<div id="header">
<h1 class="title">Radicle Link</h1>
<b>Author:</b> Kim Altintop (kim@monadic.xyz)<br/>
<b>Author:</b> The Radicle Team (dev@radicle.xyz)<br/>
<b>Revision:</b> rev2-draft<br/>
<b>Status:</b> official/experimental<br/>
<b>PDF:</b> <a href="radicle-link.pdf">radicle-link.pdf</a><br/>
</div>
<div id="TOC">
<h2 class="toc">Table of Contents</h2>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#identities">Identities</a>
<ul>
<li><a href="#data-model">Data Model</a>
<ul>
<li><a href="#radicle-urns">Radicle URNs</a></li>
<li><a href="#doc-payload">Doc Payload</a></li>
</ul></li>
<li><a href="#verification">Verification</a></li>
<li><a href="#delegations">Delegations</a></li>
<li><a href="#key-recovery">Key Recovery</a></li>
<li><a href="#effect-on-replication">Effect on Replication</a></li>
<li><a href="#git-encoding">Git Encoding</a>
<ul>
<li><a href="#serialisation">Serialisation</a></li>
<li><a href="#workflow">Workflow</a></li>
<li><a href="#implementation-notes">Implementation Notes</a></li>
</ul></li>
<li><a href="#security-considerations">Security Considerations</a></li>
</ul></li>
<li><a href="#replication">Replication</a></li>
<li><a href="#network-protocol">Network Protocol</a></li>
<li><a href="#content-discovery">Content Discovery</a></li>
<li><a href="#collaboration">Collaboration</a></li>
</ul>
</div>
<h1 id="introduction">Introduction</h1>
<h1 id="identities">Identities</h1>
<p>In order to collaborate on repositories within a consensus-free network, we must be able to refer to them using a stable identifier. Note that this identifier is a <strong>statement of intent</strong>: a repository can be described as a collection of ever-moving leaves of a DAG whose root element is the empty object. Therefore, the <em>content</em> of a repository is not enough to describe it – while two views on the repository may share objects, they may diverge substantially otherwise. Both views may however state their intent to eventually converge to the same state.</p>
<p>While in principle a random identifier with sufficient entropy would suffice for the purpose, this would put the burden of deciding which repository views are <em>legit</em> (for some definition of legit) entirely on the user. Instead, our approach is to establish an ownership proof, tied to the network identity of a peer (<code>PeerId</code>), or a set of peers, such that repository views can be replicated according to the trust relationships between peers (“tracking”).</p>
<p>Our model is based on The Update Framework (TUF)<span class="citation" data-cites="tuf"><a href="#ref-tuf" role="doc-biblioref">[1]</a></span>, conceived as a means of securely distributing software packages.</p>
<h2 id="data-model">Data Model</h2>
<p>The identity of a repository is established using a document of the form:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Doc<span class="op">&lt;</span>T<span class="op">,</span> D<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    replaces<span class="op">:</span> <span class="dt">Option</span><span class="op">&lt;</span>Revision<span class="op">&gt;,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    payload<span class="op">:</span> T<span class="op">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    delegations<span class="op">:</span> D<span class="op">,</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>where:</p>
<ul>
<li><code>Revision</code> is a cryptographic hash of a document’s contents, such that this document is content-addressable by this hash within the storage system.</li>
<li><code>replaces</code> refers to the previous revision of the document, or none if it is the first revision</li>
<li><code>payload</code> is an extensible, forwards- and backwards-compatible datatype containing application-defined metadata about the repository. The protocol interprets <em>some</em> of the properties, as described in <a href="#doc-payload">Doc Payload</a>.</li>
<li><code>delegations</code> contains the public keys of key owners who are authorised to issue and approve new revisions of the document. The delegation format depends on the type of identity being established, as detailed below.</li>
</ul>
<p>The <code>Doc</code> MUST be serialised in canonical form, e.g. <a href="http://wiki.laptop.org/go/Canonical_JSON">Canonical JSON</a>.</p>
<p>The authenticity of the <code>Doc</code> is captured by the following type:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Identity<span class="op">&lt;</span>T<span class="op">,</span> D<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    id<span class="op">:</span> ContentId<span class="op">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    root<span class="op">:</span> Revision<span class="op">,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    revision<span class="op">:</span> Revision<span class="op">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    doc<span class="op">:</span> Doc<span class="op">&lt;</span>T<span class="op">,</span> D<span class="op">&gt;,</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    signatures<span class="op">:</span> HashMap<span class="op">&lt;</span>PublicKey<span class="op">,</span> Signature<span class="op">&gt;,</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>where:</p>
<ul>
<li><code>id</code> is the content-addressable hash of the <code>Identity</code> itself</li>
<li><code>root</code> is the initial revision of the identity <code>Doc</code></li>
<li><code>revision</code> is the current revision of the identity <code>Doc</code></li>
<li><code>doc</code> is the <code>Doc</code> described by <code>revision</code></li>
<li><code>signatures</code> contains signatures over the document history, indexed by the public keys used. A signature is made over the cryptographic hash of the concatenation of the <code>Revisions</code> chain, from most recent to the <code>root</code>.</li>
</ul>
<p>An <code>Identity</code> describes the attestation of a <code>Doc</code>s validity. Attestation chains MUST be stored as a hash-linked history (each <code>Identity</code> refers to its parent) – we omit the parent <code>id</code> as a field here, as it is not used in the following sections.</p>
<p>The <code>root</code> of a verified <code>Identity</code> is the stable identifier of the repository.</p>
<h3 id="radicle-urns">Radicle URNs</h3>
<p>Identities are addressable within the Radicle Network by their stable identifier, encoded as a URN. Radicle URNs are syntactically and functionally equivalent to URNs as per <span class="citation" data-cites="rfc8141"><a href="#ref-rfc8141" role="doc-biblioref">[2]</a></span>, although we have no intention of registering our namespace with the IANA. r-, q-, and f-components are not currently honoured by the protocol, and MAY be discarded by recipients.</p>
<p>The syntax of a Radicle URN is defined as follows:</p>
<pre><code>&quot;rad&quot; &quot;:&quot; protocol &quot;:&quot; root [ &quot;/&quot; path ]</code></pre>
<p>where:</p>
<pre><code>protocol = &quot;git&quot;
root     = MULTIBASE(MULTIHASH(id))
path     = pct-encoded
id       = BYTES</code></pre>
<p>The <code>id</code> is the <code>root</code> field of a verified <code>Identity</code>, as specified previously. The <code>MULTIBASE</code> and <code>MULTIHASH</code> encodings are specified in <span class="citation" data-cites="multibase"><a href="#ref-multibase" role="doc-biblioref">[3]</a></span> and <span class="citation" data-cites="multihash"><a href="#ref-multihash" role="doc-biblioref">[4]</a></span>, respectively. The preferred alphabet for the multibase encoding is <span class="citation" data-cites="z-base32"><a href="#ref-z-base32" role="doc-biblioref">[5]</a></span>. <code>pct-encoded</code> is defined in <span class="citation" data-cites="rfc3986"><a href="#ref-rfc3986" role="doc-biblioref">[6]</a></span>, and the equivalence rules as per <span class="citation" data-cites="rfc8141"><a href="#ref-rfc8141" role="doc-biblioref">[2]</a></span> apply.</p>
<p>Within the “git” <code>protocol</code> context, the <code>path</code> component is interpreted as a <code>git</code> reference (ref), and MUST thus conform to the refname rules as described in <a href="https://git-scm.com/docs/git-check-ref-format">git-check-ref-format</a>, as if no arguments were given. The prefix “refs/” MAY be omitted, but not the refs category (i.e. “heads/master” is permitted, but “master” is not). Valid ref categories are:</p>
<pre><code>* heads
* tags
* remotes
* rad</code></pre>
<p>An invalid ref category is treated as non-existent.</p>
<p>Without a <code>path</code>, a URN is to be treated as if the default value “rad/id” was given.</p>
<p>Before resolving a <code>path</code> to a ref in local storage, the percent-encoding SHALL be removed.</p>
<h4 id="examples">Examples</h4>
<pre><code>rad:git:hwd1yredksthny1hht3bkhtkxakuzfnjxd8dyk364prfkjxe4xpxsww3try
rad:git:hwd1yredksthny1hht3bkhtkxakuzfnjxd8dyk364prfkjxe4xpxsww3try/refs/heads/next
rad:git:hwd1yredksthny1hht3bkhtkxakuzfnjxd8dyk364prfkjxe4xpxsww3try/heads/next
rad:git:hwd1yredksthny1hht3bkhtkxakuzfnjxd8dyk364prfkjxe4xpxsww3try/tags/v0.0.1
rad:git:hwd1yredksthny1hht3bkhtkxakuzfnjxd8dyk364prfkjxe4xpxsww3try/remotes/hwd1yreb5ugudg6xewxiwotj97iaj31phjdphdiej44x1acer3i45uqnwxw/heads/pu
rad:git:hwd1yreb5ugudg6xewxiwotj97iaj31phjdphdiej44x1acer3i45uqnwxw/rad/id</code></pre>
<h3 id="doc-payload">Doc Payload</h3>
<p>The <code>Doc</code> payload MUST include one of the following structures (but not both) for interpretation by the protocol:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Person <span class="op">{</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// A short name (nickname, handle), without any prefix such as the `@`</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// character</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    name<span class="op">:</span> <span class="dt">String</span><span class="op">,</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Project <span class="op">{</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// A short name</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    name<span class="op">:</span> <span class="dt">String</span><span class="op">,</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// A slightly longer description (should fit in a headline)</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    description<span class="op">:</span> <span class="dt">Option</span><span class="op">&lt;</span><span class="dt">String</span><span class="op">&gt;,</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// The default branch. &quot;master&quot; is assumed for git repositories if</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// unspecified.</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    default_branch<span class="op">:</span> <span class="dt">Option</span><span class="op">&lt;</span><span class="dt">String</span><span class="op">&gt;,</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>There are currently no restrictions on the length (in bytes) of the fields.</p>
<p>Applications MAY add additional payload data, but MUST do so in a way which unambiguously preserves the shape of the above definitions (see also: <a href="#serialisation">Serialisation</a>).</p>
<h2 id="verification">Verification</h2>
<p>Document revisions, as well as authenticity attestations form a hash-linked chain leading to the initial revision of the document. In order to verify the authenticity of a given identity attestation (<code>Identity</code>), the chain of updates must be contiguous and subject to the following verification rules.</p>
<p>We can distinguish four levels of validity:</p>
<ol type="1">
<li><p><strong>Untrusted</strong></p>
<p>The identity document is well-formed, and points to a root object which is retrievable from local storage.</p></li>
<li><p><strong>Signed</strong></p>
<p>The identity carrier passes 1., and is signed by at least one key specified in the delegations of the document.</p></li>
<li><p><strong>Quorum</strong></p>
<p>The identity carrier passes 2., and is signed by a quorum of the keys specified in the <a href="#delegations">delegations</a> of the document (<code>Q &gt; D/2</code>).</p></li>
<li><p><strong>Verified</strong></p>
<p>The identity carrier passes 3., and:</p>
<ul>
<li>The document does not refer to a previous revision, and no previous revision is known</li>
<li><strong>Or</strong>, the set of signatures forms a quorum of the <a href="#delegations">delegations</a> of the <strong>previous</strong> revision.</li>
</ul>
<p>It is an error if:</p>
<ul>
<li>No previous revision is given, but a parent in the identity attestation chain is found</li>
<li>A previous revision is given, but the identity attestation chain does not yield a parent</li>
<li>A previous revision is given, but it is not the same the parent attestation refers to</li>
<li>The current and parent attestations refer to different <code>root</code>s</li>
</ul></li>
</ol>
<p>The verification process can now be described recursively:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* State transitions, definitions elided for brevity */</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> signed(i<span class="op">:</span> Untrusted<span class="op">&lt;</span>Identity<span class="op">&gt;</span>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>Signed<span class="op">&lt;</span>Identity<span class="op">&gt;,</span> <span class="bu">Error</span><span class="op">&gt;;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> quorum(i<span class="op">:</span> Signed<span class="op">&lt;</span>Identity<span class="op">&gt;</span>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>Quorum<span class="op">&lt;</span>Identity<span class="op">&gt;,</span> <span class="bu">Error</span><span class="op">&gt;;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> verified(i<span class="op">:</span> Quorum<span class="op">&lt;</span>Identity<span class="op">&gt;,</span> parent<span class="op">:</span> <span class="dt">Option</span><span class="op">&lt;</span>Verified<span class="op">&lt;</span>Identity<span class="op">&gt;&gt;</span>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>Verified<span class="op">&lt;</span>Identity<span class="op">&gt;,</span> <span class="bu">Error</span><span class="op">&gt;;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> verify(</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    head<span class="op">:</span> Untrusted<span class="op">&lt;</span>Identity<span class="op">&gt;,</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">mut</span> parents<span class="op">:</span> <span class="kw">impl</span> <span class="bu">Iterator</span><span class="op">&lt;</span>Item <span class="op">=</span> Untrusted<span class="op">&lt;</span>Identity<span class="op">&gt;&gt;,</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>Verified<span class="op">&lt;</span>Identity<span class="op">&gt;,</span> <span class="bu">Error</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> head <span class="op">=</span> quorum(signed(head)<span class="op">?</span>)<span class="op">?;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> parent <span class="op">=</span> <span class="kw">match</span> parents<span class="op">.</span>next() <span class="op">{</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        <span class="cn">None</span> <span class="op">=&gt;</span> <span class="cn">Ok</span>(<span class="cn">None</span>)<span class="op">,</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        <span class="cn">Some</span>(parent) <span class="op">=&gt;</span> verify(parent<span class="op">,</span> parents)<span class="op">,</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}?;</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    verified(head<span class="op">,</span> parent)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<blockquote>
<p><strong>Implementation Notes</strong>:</p>
<ul>
<li>The recursive definition is given for brevity, implementations may prefer to walk the history in reverse order.</li>
<li>As an optimisation, implementations SHOULD store the result of a successful verification in persistent storage, such that verification of updates can start from the last-good state instead of the history root. Observe, however, that two different <code>Identity</code> objects (as identified by their <code>id</code>) may attest the same <code>Doc</code> revision – the persistent state SHOULD therefore allow retrieving the set of attesting <code>Identity</code>s by <code>Doc</code> revision.</li>
<li>The <code>quorum</code> predicate above SHOULD actually skip over this parent instead of aborting the procedure – it is possible that a later <code>Identity</code> reaches the quorum.</li>
</ul>
</blockquote>
<h2 id="delegations">Delegations</h2>
<p>Radicle Link distinguishes two types of identities: personal and project. The first describes an actor in the system, while the second describes a (software) project on which one or more actors collaborate. Apart from their payload types <code>T</code>, they differ in their delegations type <code>D</code>:</p>
<p>Personal identities can only delegate to anonymous keys, while project identities MAY attach a personal identity to a key delegation.</p>
<p>More formally:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Person<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="op">=</span> Identity<span class="op">&lt;</span>T<span class="op">,</span> HashSet<span class="op">&lt;</span>PublicKey<span class="op">&gt;&gt;;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> ProjectDelegation<span class="op">&lt;</span>U<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    Key(PublicKey)<span class="op">,</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    Person(Person<span class="op">&lt;</span>U<span class="op">&gt;</span>)<span class="op">,</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Project<span class="op">&lt;</span>T<span class="op">,</span> U<span class="op">&gt;</span> <span class="op">=</span> Identity<span class="op">&lt;</span>T<span class="op">,</span> ProjectDelegation<span class="op">&lt;</span>U<span class="op">&gt;&gt;;</span></span></code></pre></div>
<p>Per identity document, the <code>PublicKeys</code> delegated to MUST form a set. It is, for example, an error if a <code>PublicKey</code> appears in both the document and a <code>Person</code> delegations, or within two different <code>Person</code> delegations.</p>
<p>If a <code>Project</code> delegates to a <code>Person</code>, it MUST do so by including a specific revision of the <code>Person</code> document. The replication rules ensure that the respective <code>Person</code> histories are replicated as sibling histories [insert link].</p>
<p>If one of these sibling histories is found to not include the delegated-to revision in its ancestry path, it is said to have <strong>forked</strong>, and signatures made by one of the <code>Person</code>s keys after the point of inclusion in the <code>Project</code> no longer count towards the quorum rules. Note that this is only recoverable if a quorum of valid keys remains on the project, otherwise a <a href="#key-recovery">Key Recovery</a> procedure must be invoked on the <code>Project</code>.</p>
<p>If a sibling history is NOT <strong>forked</strong> (i.e. it includes the attested revision in its ancestry path), AND it is <strong>verified</strong>, its key delegations are considered authoritative for all <code>Project</code> attestations between the point the <code>Person</code> was delegated to, and the currently known-good head.</p>
<blockquote>
<p><strong>Implementation Note</strong>: If <code>Person</code> keys are not reused (i.e. revoked and later re-introduced) since the attestation point (which MUST be verified), it is sufficient to check for key revocations using the latest known heads of the respective histories.</p>
</blockquote>
<p>When calculating the <strong>Quorum</strong> or <strong>Verifed</strong> threshold, multiple signatures made by the set of keys of a <code>Person</code> SHALL be counted as only one vote towards the quorum. This prevents unilateral decisions made by a single <code>Person</code>. We consider this simple scheme sufficient for the purpose, but more sophisticated delegations may be supported in the future, such as customising the quorum threshold, or key roles.</p>
<p>Note that a key revocation event in a sibling <code>Person</code> history may render the project unusable if the remaining keys cannot form a quorum. Also note that the <code>Project</code> SHOULD renew the attestation from time to time.</p>
<p>The <code>delegations</code> of a <code>Project</code> are also referred to as the project’s <strong>maintainers</strong>.</p>
<h2 id="key-recovery">Key Recovery</h2>
<blockquote>
<p><strong>TODO</strong> Define how to delegate trust to a set of keys <code>K \ D</code> for the purpose of recovering from key revocations in case the quorum rules can no longer be met with the remaining keys. (i.e. “Social Recovery”)</p>
</blockquote>
<h2 id="effect-on-replication">Effect on Replication</h2>
<p>Peers MUST NOT replicate repositories whose identities they are unable to verify. If an update to the identity cannot be verified, they SHOULD keep the data they already have, but refuse to update it. Peers SHOULD keep the identity histories regardless of their verification status.</p>
<p>When <strong>cloning</strong> a repository, the attestation history according to the remote peer is fetched before all other repository contents, and the verification procedure is run on it. If this does not yield a verified status, the clone is aborted. The resulting repository state MUST include the attestation histories of at least a quorum of the delegates as per the remote peer’s view of the identity document. In <code>git</code>, the claim that this will be the case can be determined before fetching the repository contents by examining the advertised remote refs. If these preconditions are not met, the clone is aborted, and already fetched data is pruned.</p>
<p>When <strong>fetching</strong> (i.e. updating) a repository, a predetermined set of verified delegates is already known – their views of the attestation history SHALL be fetched first, along with any advertised histories not yet present in the local repository (as those might be owned by future delegates). The fetching end MUST now find a valid <code>Doc</code> revision near the tips of the available delegate histories, and pick the most recent one. If two valid identities are found of which neither is in the ancestry path of the other, the attestation chain is said to have <strong>forked</strong>. In lieu of a consensus system, it is undecidable which side of the fork to commit to, and so replication of the attested repository SHALL refuse any further updates.</p>
<blockquote>
<p><strong>TODO</strong> Fork detection (i.e. pairwise compare if in same ancestry path, either select most recent or flag as forked)</p>
</blockquote>
<h2 id="git-encoding">Git Encoding</h2>
<p>In the <code>git</code> implementation, a <code>Doc</code> corresponds to a <code>blob</code> object, stored as the single entry of a <code>tree</code> object, such that its name (acc. to the <code>tree</code>) is equal to the <code>blob</code> hash of the <em>initial</em> version of the <code>Doc</code>, serialised in canonical form. That is:</p>
<pre><code>let name = git hash-object -t blob doc.canonical_form()</code></pre>
<p>An <code>Identity</code> corresponds to a <code>commit</code> object.</p>
<p>We map the fields as follows:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Simplified git object model */</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Commit <span class="op">{</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    id<span class="op">:</span> Oid<span class="op">,</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    tree<span class="op">:</span> Tree<span class="op">,</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    message<span class="op">:</span> <span class="dt">String</span><span class="op">,</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Tree <span class="op">{</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    id<span class="op">:</span> Oid<span class="op">,</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    entries<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span>TreeEntry<span class="op">&gt;,</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> TreeEntry <span class="op">{</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    id<span class="op">:</span> Oid<span class="op">,</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    name<span class="op">:</span> <span class="dt">String</span><span class="op">,</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    object<span class="op">:</span> BlobOrTree<span class="op">,</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Blob <span class="op">{</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    id<span class="op">:</span> Oid<span class="op">,</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    content<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">u8</span><span class="op">&gt;,</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co">/* Mapping (trivial type conversions elided) */</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> commit <span class="op">=</span> <span class="co">/* .. */</span><span class="op">;</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> identity <span class="op">=</span> Identity <span class="op">{</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    id<span class="op">:</span> commit<span class="op">.</span>id<span class="op">,</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    root<span class="op">:</span> commit<span class="op">.</span>tree<span class="op">.</span>entries[<span class="dv">0</span>]<span class="op">.</span>name<span class="op">,</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    revision<span class="op">:</span> tree<span class="op">.</span>id<span class="op">,</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    doc<span class="op">:</span> deserialize(first_blob(commit<span class="op">.</span>tree)<span class="op">.</span>content)<span class="op">,</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>    signatures<span class="op">:</span> from_trailers(commit<span class="op">.</span>message)<span class="op">,</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>Where:</p>
<ul>
<li><code>first_blob</code> finds the first <code>TreeEntry</code> which is of type <code>blob</code>.</li>
<li><code>deserialize</code> is implemented by a standard JSON parser. <code>Person</code> delegations from a <code>Project</code> are specified in the <code>Project</code>’s <code>Doc</code> as URNs, which are resolved by parsing a <code>blob</code> object of the same name as the URN’s <code>id</code> field below the <code>tree</code> entry of type directory named <code>delegations</code>.</li>
<li><code>from_trailers</code> interprets the commit message as per <a href="https://git-scm.com/docs/git-interpret-trailers">git-interpret-trailers</a>, and extracts the signatures from trailers with the token <code>x-rad-signature</code>.</li>
</ul>
<blockquote>
<p><strong>TODO</strong> Specify exact format of signature trailer value (BASE64(public key || signature))</p>
</blockquote>
<p>The commit chain is stored in a branch at <code>refs/rad/id</code>.</p>
<blockquote>
<p><strong>TODO</strong> Insert repository layout spec as per <a href="../rfc/identity_resolution.md">RFC</a> here</p>
</blockquote>
<h3 id="serialisation">Serialisation</h3>
<p>The <code>Doc</code> is serialised in <a href="http://wiki.laptop.org/go/Canonical_JSON">Canonical JSON</a> format. However, all ASCII plane control characters (<code>U+0000 - U+007F</code>) MUST be escaped according to <span class="citation" data-cites="rfc8259"><a href="#ref-rfc8259" role="doc-biblioref">[7]</a>, Section 7</span>. Hexadecimal escape sequences MUST be in lower-case. This contradicts <a href="http://wiki.laptop.org/go/Canonical_JSON">Canonical JSON</a>, but permits their claim that “Canonical JSON is parsable with any full JSON parser.”</p>
<p>In addition to the shape defined above, a field <code>version</code> MUST be included with a value of <code>0</code> (zero) as of this version of the specification.</p>
<p><code>Revision</code> values are serialised as JSON strings, encoded as a <span class="citation" data-cites="multihash"><a href="#ref-multihash" role="doc-biblioref">[4]</a></span> value wrapped in a <span class="citation" data-cites="multibase"><a href="#ref-multibase" role="doc-biblioref">[3]</a></span> encoding using the <span class="citation" data-cites="z-base32"><a href="#ref-z-base32" role="doc-biblioref">[5]</a></span> alphabet.</p>
<p><code>PublicKey</code> values are serialised as JSON strings, which are obtained by concatenating the <code>0</code> byte (as a version identifier) with the Ed25519 scalar (the public key) encoded as per <span class="citation" data-cites="rfc8032"><a href="#ref-rfc8032" role="doc-biblioref">[8]</a></span>, and then wrapping in a <span class="citation" data-cites="multibase"><a href="#ref-multibase" role="doc-biblioref">[3]</a></span> encoding using the <span class="citation" data-cites="z-base32"><a href="#ref-z-base32" role="doc-biblioref">[5]</a></span> alphabet.</p>
<p><code>Person</code> delegations are serialised as a JSON array of <code>PublicKey</code> values. Duplicate elements MUST be a deserialisation error.</p>
<p><code>Project</code> delegations are serialised as a JSON array of either <code>PublicKey</code> or URN values without tagging. Duplicate elements MUST be a deserialisation error.</p>
<p>The <code>payload</code> is encoded as a JSON object using <span class="citation" data-cites="whatwg-url"><a href="#ref-whatwg-url" role="doc-biblioref">[9]</a></span> URLs as the keys, and JSON objects of the <code>radicle-link</code>- or user-specified payload objects as the values. Implementations MUST validate that a valid <code>radicle-link</code> payload is present in the object, and SHOULD preserve user extensions typed as the JSON object model. Duplicate URL keys are a deserialisation error.</p>
<p>The URL keys serve as namespaces, as well as version identifiers. Versioning simplifies schema evolution. However, implementations MUST ensure that they can interpret both unknown (future) and outdated (past) versions. This specifically means that the URL keys for <code>radicle-link</code> payloads MUST be considered equal iff their prefix sans the version identifier is equal, and duplicates rejected accordingly. It is RECOMMENDED that extension namespaces are also constructed such that the version identifier is the suffix, and <code>radicle-link</code> implementations SHOULD provide prefix-queries on the extension namespaces in a payload object.</p>
<p>Additionally, empty optional fields SHOULD be included with a value of <code>null</code>, rather than omitting them from the output.</p>
<p>This specification does not devise a schema resolution mechanism based on the payload URLs, nor does it mandate schema validation, although applications are free to implement both.</p>
<p>Pending self-hosting, which will allow precise versioning by content-address, the URLs for <code>radicle-link</code> payloads are:</p>
<dl>
<dt>Person</dt>
<dd><p>https://radicle.xyz/link/identities/person/v1</p>
</dd>
<dt>Project</dt>
<dd><p>https://radicle.xyz/link/identities/project/v1</p>
</dd>
</dl>
<p>The <code>radicle.xyz</code> domain is reserved for application payloads defined by the Radicle Core Team.</p>
<h4 id="examples-1">Examples</h4>
<p>A simple example if an initial <code>Doc</code>, embedding a Decentralized Identifier (DID) document <span class="citation" data-cites="did-core"><a href="#ref-did-core" role="doc-biblioref">[10]</a></span> in a <code>Person</code> payload:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;version&quot;</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;replaces&quot;</span><span class="fu">:</span> <span class="kw">null</span><span class="fu">,</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;payload&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;https://radicle.xyz/link/identities/person/v1&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;cloudhead&quot;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">},</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;https://www.w3.org/ns/did&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;@context&quot;</span><span class="fu">:</span> <span class="st">&quot;https://www.w3.org/ns/did/v1&quot;</span><span class="fu">,</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;did:example:123456789abcdefghi&quot;</span><span class="fu">,</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;authentication&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="fu">{</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;did:example:123456789abcdefghi#keys-1&quot;</span><span class="fu">,</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;Ed25519VerificationKey2018&quot;</span><span class="fu">,</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;controller&quot;</span><span class="fu">:</span> <span class="st">&quot;did:example:123456789abcdefghi&quot;</span><span class="fu">,</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;publicKeyBase58&quot;</span><span class="fu">:</span> <span class="st">&quot;H3C2AVvLMv6gmMNam3uVAjZpfkcJCwDwnZn6z3wXmqPV&quot;</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>            <span class="fu">}</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;service&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="fu">{</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;id&quot;</span><span class="fu">:</span><span class="st">&quot;did:example:123456789abcdefghi#vcs&quot;</span><span class="fu">,</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;VerifiableCredentialService&quot;</span><span class="fu">,</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;serviceEndpoint&quot;</span><span class="fu">:</span> <span class="st">&quot;https://example.com/vc/&quot;</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>            <span class="fu">}</span><span class="ot">]</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;delegations&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;hyn4hnppkiu61kpx91o9n5jtj37brujcgj7yp8d1derwz4fbk3tqjw&quot;</span><span class="ot">,</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;hyb8kud543qkfdxkge6ecj6zziuam6w6fqhujgebbfuufmpdxt5uok&quot;</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Note that the example is <strong>not</strong> in canonical form.</p>
<h3 id="workflow">Workflow</h3>
<p>Our construction of the <code>Identity</code> from a git commit allows for multiple <code>id</code>s to describe the same revision of the document (and thus be equally valid). This means that the respective delegates’ histories may diverge in their <em>commit</em> histories, but still converge to an agreement on the validity of the attested document revision.</p>
<p>While this allows for arbitrarily complex workflows (and history topologies), we RECOMMEND to converge to equal or joined histories. This can be achieved by selecting a leader to commit the quorum (and the followers adopting this commit), or settling the vote out-of-band.</p>
<p>As an example, a simple leader-based workflow could proceed as follows:</p>
<ul>
<li>Peer <code>A</code> proposes a new revision on her view of the <code>rad/id</code> branch. The revision is signed by <code>A</code>’s public key.</li>
<li>Peers <code>B</code> and <code>C</code> receive this proposal, and sign it off on their own <code>rad/id</code> branches by creating a new commit over the same <code>tree</code> as the propsal, but including their own signatures (they may also include <code>A</code>’s signature for posterity, but that is not required as the verification procedure will skip those commits).</li>
<li>Peer <code>A</code> is also designated as the leader, so after receiving the updates of <code>B</code> and <code>C</code>, she creates a new commit on her branch, merging both <code>B</code>’s and <code>C</code>’s “votes” (an “octopus merge”), and preserving the signature trailers of all three.</li>
<li><code>B</code> and <code>C</code> receive this “finalisation” commit, and simply merge it into their own branches. This is a fast-forward merge.</li>
</ul>
<h3 id="implementation-notes">Implementation Notes</h3>
<p>Implementations are encouraged to store verification results (including detected forks) persistently, both for efficiency reasons, and to preserve this state even if the corresponding repositories are removed from local storage (e.g. because they reached an irrecoverable state).</p>
<p>This can be implemented without the need for a secondary storage system by leveraging <a href="https://git-scm.com/docs/git-notes">git-notes</a>:</p>
<p>In the private section of the “monorepo” (i.e. outside any namespaces), store a note for every verified tree object, with the set of commit OIDs which contributed to this verified state encoded in the note message (e.g. <code>x-rad-verified-by: &lt;OID&gt;</code>). Determining whether a given revision has been verified before is an <code>O(1)</code> operation: only the notes object needs to be consulted. Verification can proceed incrementally by skipping commits pointing to pre-verified trees. Note that the notes objects can be loaded into memory upfront, and that the skipping only requires to read the commit headers from disk.</p>
<p>Persisting forks requires to annotate commit objects as well, and to update the tree notes to reflect the new state.</p>
<h2 id="security-considerations">Security Considerations</h2>
<ul>
<li><p>Colluding key owners can force the network into following a <em>fork</em> of an already published identity. While peers are <em>encouraged</em> to persist information about detected forks, they are not incentivised to keep that information forever. After a period of interrupted replication, the fork may thus prevail.</p></li>
<li><p>As outlined in <a href="#delegations">Delegations</a>, <code>Person</code> and <code>Project</code> histories are not causally related. This allows for censorship attacks, unless this relationship is securely established by an external system.</p></li>
<li><p>The security of identity updates rests on the probability of an attacker to gain control over a quorum of keys. That is, we can operate on the assumption that the individual keys can be in “online” storage, so as long as the breach of a minority of the key delegations can be mitigated by the remaining ones.</p>
<p>This poses a usability problem, however, especially for personal identities: users can hardly be expected to have access to <code>n &gt; 2</code> devices within an acceptable time window in order to finalise an identity update. In practice, many will have access to a portable hardware token which provides reasonable protection of the keys it stores, and will want to finalise updates immediately by only two signatures: by the current workstation + by the hardware token.</p>
<p>A future amendment to this document SHALL specify the rules for marking a key delegation as being considered “secure,” such that the quorum threshold can be computed differently if such a “secure” signature is present.</p></li>
<li><p>Implementations SHOULD limit the download of untrusted identity histories to a reasonable size in bytes.</p></li>
</ul>
<h1 id="replication">Replication</h1>
<h1 id="network-protocol">Network Protocol</h1>
<h1 id="content-discovery">Content Discovery</h1>
<h1 class="unnumbered" id="collaboration">Collaboration</h1>
<div id="refs" class="references csl-bib-body" role="doc-bibliography">
<div id="ref-tuf" class="csl-entry" role="doc-biblioentry">
<p><div class="csl-left-margin">[1] </div><div class="csl-right-inline">J. Cappos et.al., <span>“<span>The Update Framework Specification</span>.”</span> 2019. <a href="https://github.com/theupdateframework/specification/blob/0cddec0a60f95f06d2e23ebadbd876eeb62c1df3/tuf-spec.md">https://github.com/theupdateframework/specification/blob/0cddec0a60f95f06d2e23ebadbd876eeb62c1df3/tuf-spec.md</a></div></p>
</div>
<div id="ref-rfc8141" class="csl-entry" role="doc-biblioentry">
<p><div class="csl-left-margin">[2] </div><div class="csl-right-inline">P. Saint-Andre and Dr. J. C. Klensin, <span>“<span>Uniform Resource Names (URNs)</span>.”</span> RFC 8141; RFC Editor, Apr-2017. <a href="https://rfc-editor.org/rfc/rfc8141.txt">https://rfc-editor.org/rfc/rfc8141.txt</a></div></p>
</div>
<div id="ref-multibase" class="csl-entry" role="doc-biblioentry">
<p><div class="csl-left-margin">[3] </div><div class="csl-right-inline"><a href="https://github.com/multiformats/multibase/blob/f2d3c43f9d30d7dca178dc3220c5bf50963a1e70/README.md">https://github.com/multiformats/multibase/blob/f2d3c43f9d30d7dca178dc3220c5bf50963a1e70/README.md</a>. [Accessed: 29-Jul-2019]</div></p>
</div>
<div id="ref-multihash" class="csl-entry" role="doc-biblioentry">
<p><div class="csl-left-margin">[4] </div><div class="csl-right-inline"><a href="https://github.com/multiformats/multihash/blob/cde1aef8158d193d73012b7d730013f05c2f7063/README.md">https://github.com/multiformats/multihash/blob/cde1aef8158d193d73012b7d730013f05c2f7063/README.md</a>. [Accessed: 26-Jul-2019]</div></p>
</div>
<div id="ref-z-base32" class="csl-entry" role="doc-biblioentry">
<p><div class="csl-left-margin">[5] </div><div class="csl-right-inline"><a href="http://philzimmermann.com/docs/human-oriented-base-32-encoding.txt">http://philzimmermann.com/docs/human-oriented-base-32-encoding.txt</a>. [Accessed: 18-Aug-2020]</div></p>
</div>
<div id="ref-rfc3986" class="csl-entry" role="doc-biblioentry">
<p><div class="csl-left-margin">[6] </div><div class="csl-right-inline">T. Berners-Lee, R. T. Fielding, and L. M. Masinter, <span>“<span>Uniform Resource Identifier (URI): Generic Syntax</span>.”</span> RFC 3986; RFC Editor, Jan-2005. <a href="https://rfc-editor.org/rfc/rfc3986.txt">https://rfc-editor.org/rfc/rfc3986.txt</a></div></p>
</div>
<div id="ref-rfc8259" class="csl-entry" role="doc-biblioentry">
<p><div class="csl-left-margin">[7] </div><div class="csl-right-inline">T. Bray, <span>“<span>The JavaScript Object Notation (JSON) Data Interchange Format</span>.”</span> RFC 8259; RFC Editor, Dec-2017. <a href="https://rfc-editor.org/rfc/rfc8259.txt">https://rfc-editor.org/rfc/rfc8259.txt</a></div></p>
</div>
<div id="ref-rfc8032" class="csl-entry" role="doc-biblioentry">
<p><div class="csl-left-margin">[8] </div><div class="csl-right-inline">S. Josefsson and I. Liusvaara, <span>“<span>Edwards-Curve Digital Signature Algorithm (EdDSA)</span>.”</span> RFC 8032; RFC Editor, Jan-2017. <a href="https://rfc-editor.org/rfc/rfc8032.txt">https://rfc-editor.org/rfc/rfc8032.txt</a></div></p>
</div>
<div id="ref-whatwg-url" class="csl-entry" role="doc-biblioentry">
<p><div class="csl-left-margin">[9] </div><div class="csl-right-inline"><a href="https://url.spec.whatwg.org/commit-snapshots/1979119c2082b1e0f7f77aead4651700841a4abe/">https://url.spec.whatwg.org/commit-snapshots/1979119c2082b1e0f7f77aead4651700841a4abe/</a>. [Accessed: 20-Aug-2020]</div></p>
</div>
<div id="ref-did-core" class="csl-entry" role="doc-biblioentry">
<p><div class="csl-left-margin">[10] </div><div class="csl-right-inline"><a href="https://www.w3.org/TR/did-core/">https://www.w3.org/TR/did-core/</a>. [Accessed: 21-Jul-2020]</div></p>
</div>
</div>
</body>
</html>
